# /docs/TROUBLESHOOTING.md
# 说明：列出 Web 与小程序常见问题及处理步骤，帮助开发者快速定位故障。

## Web 常见问题

### 画布模糊
1. 检查浏览器是否设置了缩放或系统层面的显示缩放；若存在缩放，请将页面还原为 100%。
2. 观察设备像素比（DPR），必要时在设置面板调整画布尺寸，让 `canvas` 的 CSS 尺寸与物理像素更匹配。
3. 如仍然模糊，可在开发者工具中手动调用 `resizeCanvas()`，确认脚本是否成功应用 DPR。

### 字体不居中
1. 在设置面板微调 `pad` 相关参数（即格子间隙与画布大小），确保字号计算空间充足。
2. 检查自定义字体是否加载失败，可暂时退回系统默认字体验证定位问题。
3. 通过 `fitFont` 的日志观察测量值，如 `measureText` 不支持，可考虑降低字号上限。

### 本地存储权限异常
1. 若浏览器处于无痕模式，LocalStorage 可能不可写；请切换至常规窗口或允许站点存储。
2. 检查浏览器隐私设置是否禁用第三方 Cookie 或本地数据，必要时将站点加入允许列表。
3. 若被安全软件拦截，请在白名单中放行或改用手动导出/导入 JSON 的方式保存进度。

## 小程序常见问题

### `canvas` 文字度量差异
1. 由于小程序环境中 `measureText` 表现与 Web 不完全一致，建议结合经验值设置字重与字号上限。
2. 若出现截断，可在 `miniprogram` 的绘制逻辑中增加备用的固定字号回退策略。
3. 在开发者工具中启用真机调试，观察不同机型的渲染差异并据此调整参数。

### 存储空间满或权限问题
1. 微信小程序的本地存储上限较低，建议定期清理历史存档或导出 JSON 后删除旧数据。
2. 若报错 `fail no permission`，请确认未在小游戏环境调用受限 API，并检查基础库版本是否满足要求。
3. 在开发者工具中重置项目数据，可验证是否为存储空间不足导致。

## 进度 JSON 兼容性
1. 对于缺失字段的旧版 JSON，导入逻辑会回退到默认配置，并在控制台输出温和告警。
2. 建议在导出前记录版本号，便于与未来的字段演变对照；读取失败时可快速定位缺项。
3. 如需手动编辑 JSON，请确保 `settings`、`progress`、`bestScore` 与 `replay` 块结构完整，避免破坏键名。
