<!-- /miniprogram/pages/index/index.wxml -->
<!-- 说明：小程序首页，包含画布、信息栏与操作控件，本轮新增撤销、演示、复盘与成就展示等功能。 -->

<view class="wrap">
  <!-- 标题 -->
  <view class="row">
    <text class="title">Stage2048（关卡 2048）</text>
  </view>

  <!-- 画布：同时设置 CSS 尺寸与实际像素宽高，绑定触摸事件用于识别滑动方向 -->
  <canvas
    id="game"
    canvas-id="game"
    style="width: {{canvasPx}}px; height: {{canvasPx}}px;"
    width="{{canvasPx}}"
    height="{{canvasPx}}"
    bindtouchstart="onTouchStart"
    bindtouchend="onTouchEnd"
  ></canvas>

  <!-- 信息栏：关卡+目标 -->
  <view class="row">
    <text class="meta">关卡 {{level}}（{{size}}×{{size}}）</text>
    <text class="meta">目标 {{target}}</text>
  </view>

  <!-- 信息栏：得分/总分/最佳 -->
  <view class="row">
    <text class="score" aria-role="text" aria-label="当前得分 {{score}}">得分 {{score}}</text>
    <text class="score" aria-role="text" aria-label="累计总分 {{totalScore}}">总分 {{totalScore}}</text>
    <text class="score" aria-role="text" aria-label="最佳成绩 {{bestScore}}">最佳 {{bestScore}}</text>
  </view>

  <!-- 成就徽章展示 -->
  <view class="row">
    <text class="meta" aria-role="note" aria-label="成就徽章 {{achvLabel}}">{{achv}}</text>
  </view>

  <!-- 操作区：重开 / 撤销 / 重置 / 清空 -->
  <view class="row">
    <button class="btn" bindtap="onRestart" aria-label="重开本关">重开本关</button>
    <button class="btn" bindtap="onUndo" aria-label="撤销一步">撤销一步</button>
    <button class="btn" bindtap="onResetProgress" aria-label="重置进度">重置进度</button>
    <button class="btn" bindtap="onClearBest" aria-label="清空最佳分">清空最佳分</button>
  </view>

  <!-- 操作区：演示模式 / 重放复盘 -->
  <view class="row">
    <view class="demo-item" aria-role="switch" aria-label="演示模式">
      <switch class="demo-switch" checked="{{demo}}" bindchange="onDemoToggle" aria-label="切换演示模式" />
      <text class="meta">演示模式</text>
    </view>
    <button class="btn" bindtap="onReplay" aria-label="重放复盘">重放复盘</button>
  </view>

  <!-- 关卡包导入与清除按钮 -->
  <view class="row">
    <button class="btn" bindtap="onImportPack" aria-label="从剪贴板导入关卡包">导入关卡包</button>
    <button class="btn" bindtap="onClearPack" aria-label="清除关卡包">清除关卡包</button>
  </view>

  <!-- 关卡包状态提示 -->
  <view class="row pack-tip-row">
    <text class="meta pack-tip" aria-role="note" aria-label="关卡包状态 {{packStatus}}">{{packStatus}}</text>
  </view>

  <!-- 状态播报区域，使用 aria-role="status" 供朗读 -->
  <view class="sr-only" aria-role="status" aria-live="polite">{{statusText}}</view>
</view>
