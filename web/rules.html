<!-- 文档类型声明，指示浏览器采用 HTML5 标准渲染 -->
<!doctype html>
<!-- html 根元素，设置页面语言为中文 -->
<html lang="zh">
<!-- head 区域开始，用于定义元数据与样式 -->
<head>
  <!-- 指定字符集为 UTF-8，确保中文正常显示 -->
  <meta charset="utf-8" />
  <!-- 设置视口宽度与缩放，保证移动端显示效果 -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- 页面标题，展示在浏览器标签上 -->
  <title>Stage2048 规则编辑器</title>
  <!-- 内联样式块，提供页面布局与表单的基础样式 -->
  <style>
    /* 设置全局字体与背景色，让页面保持与主站一致 */
    body { margin: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background: #faf8ef; color: #776e65; }
    /* 为主容器设置最大宽度与居中布局 */
    .container { max-width: 960px; margin: 0 auto; padding: 24px 16px 48px; box-sizing: border-box; display: flex; flex-direction: column; gap: 16px; }
    /* 页面主标题样式，加粗并增大字号 */
    h1 { margin: 0; font-size: 28px; font-weight: 700; }
    /* 副标题或段落的默认样式 */
    p { margin: 0; line-height: 1.6; }
    /* 区块容器采用浅色背景与圆角，区分不同功能区域 */
    section { background: rgba(255, 255, 255, 0.9); border: 1px solid #e0d8c9; border-radius: 12px; padding: 16px; box-sizing: border-box; display: flex; flex-direction: column; gap: 12px; }
    /* 表单字段容器，采用网格布局自适应排列 */
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }
    /* 表单字段采用垂直布局，标签与控件分行显示 */
    .field { display: flex; flex-direction: column; gap: 4px; font-size: 14px; }
    /* 输入框与下拉选择统一样式 */
    .field input, .field select { padding: 6px 8px; border: 1px solid #cbbfb1; border-radius: 6px; font-size: 14px; box-sizing: border-box; color: #443a2b; background: #fff; }
    /* 复选框字段水平排列，保持语义 */
    .field-inline { flex-direction: row; align-items: center; }
    /* 随机权重编辑区的尺寸块样式 */
    .size-block { border: 1px dashed #d7c9b5; border-radius: 8px; padding: 12px; display: flex; flex-direction: column; gap: 8px; background: #fdfaf2; }
    /* 尺寸块头部用于展示尺寸输入与删除按钮 */
    .size-header { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    /* 权重表格使用全宽布局并带有分隔线 */
    .weight-table { width: 100%; border-collapse: collapse; }
    /* 表头与单元格的边框与内边距样式 */
    .weight-table th, .weight-table td { border: 1px solid #e0d8c9; padding: 4px 6px; text-align: left; font-size: 13px; }
    /* 内部按钮使用轻量样式，与主按钮区区分 */
    .size-block button { padding: 4px 10px; border: 1px solid #c5b8a4; border-radius: 6px; background: #fff; cursor: pointer; color: #5a4d3a; }
    /* 主操作按钮区域水平排列并居中 */
    .actions { display: flex; flex-wrap: wrap; gap: 12px; justify-content: flex-start; }
    /* 主按钮样式更显眼，方便用户操作 */
    .primary-button { padding: 8px 16px; border: none; border-radius: 8px; background: #8f7a66; color: #fff; font-size: 14px; cursor: pointer; }
    /* 文件输入按钮使用隐藏真实控件的方式定制外观 */
    .file-input-label { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; border-radius: 8px; background: #c9b28a; color: #fff; cursor: pointer; }
    /* 隐藏原生文件输入，仅保留可点击区域 */
    .file-input-label input { display: none; }
    /* 错误列表采用红色字体并显示为无序列表 */
    .error-list { margin: 0; padding-left: 20px; color: #d93025; font-size: 13px; }
    /* 权重和校验提示使用较小字号并带颜色 */
    .sum-tip { font-size: 12px; color: #b36b00; }
    /* 页脚文案居中显示，提供版权说明 */
    footer { text-align: center; font-size: 12px; color: #998675; padding-bottom: 24px; }
  </style>
</head>
<!-- body 区域开始，包含可见内容 -->
<body>
  <!-- 页面主容器，包裹所有内容区块 -->
  <div class="container">
    <!-- 标题区域，向用户说明页面用途 -->
    <header>
      <!-- 页面主标题，强调当前为规则编辑器 -->
      <h1>Stage2048 规则编辑器</h1>
      <!-- 说明文字，提示支持导入导出以及保存设置 -->
      <p>通过下方表单编辑游戏规则，可导入已有配置或导出备份，保存后返回主页面即可生效。</p>
    </header>
    <!-- 基础设置区块，包含画布、间隙、动画等字段 -->
    <section aria-labelledby="basic-settings-title">
      <!-- 子标题用于无障碍描述区块内容 -->
      <h2 id="basic-settings-title">基础设置</h2>
      <!-- 使用网格布局排列多个表单字段 -->
      <div class="grid">
        <!-- 画布尺寸输入字段 -->
        <label class="field" for="input-canvas-size">
          <!-- 字段标签说明输入含义 -->
          <span>画布尺寸（像素）</span>
          <!-- 数字输入框，用于控制画布 CSS 尺寸 -->
          <input id="input-canvas-size" type="number" min="200" max="1024" step="10" />
        </label>
        <!-- 格子间隙输入字段 -->
        <label class="field" for="input-gap">
          <!-- 字段标签说明格子间距含义 -->
          <span>格子间隙（像素）</span>
          <!-- 数字输入框，用于设置棋盘间隙 -->
          <input id="input-gap" type="number" min="0" max="48" step="1" />
        </label>
        <!-- 动画开关字段，采用复选框 -->
        <label class="field field-inline" for="input-animate">
          <!-- 复选框控件，决定是否启用动画 -->
          <input id="input-animate" type="checkbox" />
          <!-- 与复选框同行的文本说明 -->
          <span>启用动画</span>
        </label>
        <!-- 固定随机种子输入字段 -->
        <label class="field" for="input-seed">
          <!-- 字段标签说明用途 -->
          <span>固定随机种子（可留空）</span>
          <!-- 文本输入框，允许自定义种子字符串 -->
          <input id="input-seed" type="text" placeholder="示例：demo-seed" />
        </label>
      </div>
    </section>
    <!-- LEVELS 设置区块，包含关卡相关选项 -->
    <section aria-labelledby="levels-settings-title">
      <!-- 子标题用于描述关卡配置区域 -->
      <h2 id="levels-settings-title">LEVELS 设置</h2>
      <!-- 网格布局承载关卡相关字段 -->
      <div class="grid">
        <!-- 起始棋盘尺寸输入字段 -->
        <label class="field" for="input-start-size">
          <!-- 字段标签说明尺寸范围 -->
          <span>起始棋盘尺寸（2~10）</span>
          <!-- 数字输入框，限制在有效范围内 -->
          <input id="input-start-size" type="number" min="2" max="10" step="1" />
        </label>
        <!-- 累计总分开关字段 -->
        <label class="field field-inline" for="input-carry-score">
          <!-- 复选框用于控制是否累计总分 -->
          <input id="input-carry-score" type="checkbox" />
          <!-- 与复选框同行的文字描述 -->
          <span>累计总分</span>
        </label>
        <!-- 目标函数选择字段 -->
        <label class="field" for="input-target-fn">
          <!-- 字段标签介绍目标函数含义 -->
          <span>目标函数键</span>
          <!-- 下拉选择框，提供 power 与 fibonacci 两个选项 -->
          <select id="input-target-fn">
            <!-- 默认选项 power 对应 2 的幂目标 -->
            <option value="power">power（2 的幂）</option>
            <!-- 另一选项 fibonacci 对应斐波那契目标 -->
            <option value="fibonacci">fibonacci（斐波那契）</option>
          </select>
        </label>
      </div>
    </section>
    <!-- 插件选择区块，允许多选启用插件 -->
    <section aria-labelledby="plugins-title">
      <!-- 子标题描述插件配置区域 -->
      <h2 id="plugins-title">插件启用</h2>
      <!-- 提示文字说明插件多选逻辑 -->
      <p>可选择需要启用的插件，若列表为空则表示当前无插件。</p>
      <!-- 多选下拉框容器 -->
      <label class="field" for="input-plugins">
        <!-- 字段标签说明多选操作 -->
        <span>启用插件（可多选）</span>
        <!-- 多选下拉框，通过 JS 动态填充选项 -->
        <select id="input-plugins" multiple size="6"></select>
      </label>
      <!-- 当无插件时展示的提示文本容器 -->
      <p id="plugin-hint">未检测到插件注册表，使用空列表。</p>
    </section>
    <!-- 随机权重编辑区块，提供动态增删功能 -->
    <section aria-labelledby="weights-title">
      <!-- 子标题描述随机权重编辑区 -->
      <h2 id="weights-title">随机生成权重</h2>
      <!-- 提示说明权重和校验与操作方式 -->
      <p>每个棋盘尺寸需配置至少一条权重项，概率之和需接近 1（允许误差 ±0.001）。</p>
      <!-- 尺寸块列表容器，由脚本填充具体内容 -->
      <div id="weights-container" class="weights"></div>
      <!-- 操作按钮：新增尺寸 -->
      <button id="btn-add-size" type="button" class="primary-button">新增尺寸</button>
    </section>
    <!-- 操作按钮区块，提供导入导出与应用功能 -->
    <section aria-labelledby="actions-title">
      <!-- 子标题描述操作区域 -->
      <h2 id="actions-title">导入、导出与应用</h2>
      <!-- 操作按钮容器，包含导出、导入与应用 -->
      <div class="actions">
        <!-- 导出 JSON 的按钮，点击后触发下载 -->
        <button id="btn-export" type="button" class="primary-button">导出规则 JSON</button>
        <!-- 自定义文件输入标签，用于导入 JSON -->
        <label class="file-input-label" for="input-import">
          <!-- 显示在按钮上的提示文字 -->
          <span>从 JSON 导入</span>
          <!-- 文件输入控件，仅接受 JSON 文件 -->
          <input id="input-import" type="file" accept="application/json" />
        </label>
        <!-- 应用到游戏的按钮，保存配置到 localStorage -->
        <button id="btn-apply" type="button" class="primary-button">应用到游戏</button>
        <!-- 返回主页面的链接，便于用户快速跳转 -->
        <a id="link-back" href="./index.html" class="primary-button" style="text-decoration:none; text-align:center;">返回主页面</a>
      </div>
      <!-- 提示文字提醒应用后可能影响现有进度 -->
      <p>应用设置时不会自动清除进度，但新规则可能导致当前盘面不兼容，建议回到主页面后重置关卡。</p>
      <!-- 错误列表容器，供脚本填充校验消息 -->
      <ul id="error-list" class="error-list"></ul>
    </section>
    <!-- 页脚区域，提供版权或项目说明 -->
    <footer>
      <!-- 简短文案，说明项目来源与用途 -->
      <p>Stage2048 规则编辑器 · 仅供演示与自定义配置使用</p>
    </footer>
  </div>
  <!-- 引入规则编辑器脚本，负责数据逻辑与交互 -->
  <script type="module" src="./rules.mjs"></script>
</body>
<!-- html 根元素结束 -->
</html>
