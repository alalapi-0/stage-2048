# Stage2048（关卡 2048）

## 项目简介
Stage2048 是一个以纯 Canvas 实现的数字格子 2048 游戏，将在后续轮次中扩展为同时支持 Web 浏览器与微信小程序的双端版本。项目通过关卡系统让玩家从 2×2 棋盘起步，逐步解锁更大的棋盘尺寸，并让目标值随关卡增长，使游戏体验更加循序渐进。

## 架构总览
```
stage-2048
├─ core/           # 平台无关：2048 核心逻辑与关卡管理（后续轮次实现）
├─ web/            # 浏览器版 Canvas 渲染与交互
├─ miniprogram/    # 微信小程序版 Canvas 渲染与交互
└─ docs/           # 配置与设计文档
```

## 快速开始（本轮）
- **Web**：双击打开 `web/index.html`，看到占位页面即表示当前骨架搭建成功（后续轮次将注入真正的 Canvas 渲染）。
- **小程序**：使用微信开发者工具导入 `miniprogram/` 目录，在项目信息中填写你自己的 `appid`，即可预览占位页面（后续轮次会补齐绘制与交互）。

## 六轮开发计划
| 轮次 | 目标 | 产物 | 验收标准 |
| --- | --- | --- | --- |
| 1 | 脚手架与文档 | 目录、规范、占位页 | Web 与小程序能打开占位页；文档齐全 |
| 2 | 核心逻辑（含从 1 起步）+ 关卡管理 | Game2048 与 LevelManager（ESM/CJS 双发） | 控制台冒烟测试通过 |
| 3 | Web Canvas 渲染与交互 | 适配字号绘制、键盘与触摸、关卡 HUD | 浏览器可玩并显示关卡与目标 |
| 4 | 小程序接入关卡 | 画布绘制、手势、关卡推进 | 开发者工具可玩并能通关 |
| 5 | 参数化与持久化 | 统一配置、bestScore、总分累计 | Web/localStorage 与小程序存储正常 |
| 6 | 质量与文档收尾 | 规范、FAQ、问题记录模板 | 文档完善，无二进制入库 |

## 用户需填写的参数
| 字段 | 位置 | 类型/示例 | 默认 | 说明 |
| --- | --- | --- | --- | --- |
| boardSize | 运行时 | number | 4 | 当前棋盘尺寸（关卡系统会覆盖） |
| gap | 运行时 | number(px) | 12 | 格子间隙 |
| colors | 运行时 | map | 见文档 | 数值→前景/背景色 |
| randomTileWeights | 运行时 | map | {1:0.9, 2:0.1} | 新方块概率（从 1 起步满足 1+1=2） |
| levelStartSize | 配置 | number | 2 | 关卡起始尺寸（2×2） |
| carryScore | 配置 | boolean | true | 关卡累计总分 |
| targetFn | 配置 | function(size => 2**(size+3)) | size => 2**(size+3) | 目标值随尺寸增长的函数 |
| randomTileWeightsBySize | 配置 | map | {} | 可按尺寸覆盖新方块分布 |

## 提交与仓库规范
- 所有源代码与配置文件必须逐行添加中文注释，确保后续协作成员能快速理解意图。
- 禁止任何二进制文件入库，包括图片、压缩包、构建产物等。
- 建议提交信息前缀使用 `core: ...`、`web: ...`、`mini: ...`、`level: ...`、`docs: ...` 等模块化标签。
- 每次改动后需要在 `README.diff.md` 中记录差异（模板见文件）。

## FAQ（占位）
- **字体度量在不同环境可能不同，如何处理？** 将在后续实现中采用二分法与近似比例来调整绘制尺寸，以保证跨平台一致性。
- **小程序 Canvas 与 Web Canvas API 有差异怎么办？** 后续会在各自平台的渲染层中进行适配，确保核心逻辑保持统一。

